[tox]
envlist = py{39,310,311,312}-{root,time_utils}
skipsdist = true

[testenv]
description = Run lint and tests for {envname}
changedir =
    root: .
    time_utils: time_utils
deps =
    pytest
    flake8
commands_pre =
    python -m pip install -U pip
    python -m pip install -e .
    python -m pip install -r requirements.txt || python -c "print('no requirements.txt')"
commands =
    flake8 src || python -c "print('no src directory to lint')"
    pytest -q || python - <<'PY'
    try:
        import importlib
        import pathlib
        pkg = pathlib.Path('.').resolve().name
        if pkg == 'time_utils':
            importlib.import_module('time_utils')
        else:
            # Attempt to import inc_join top-level module
            importlib.import_module('inc_join')
        print('Import ok')
    except Exception as e:
        raise SystemExit(f'Import failed: {e}')
    PY

[flake8]
max-line-length = 88
extend-ignore = E203, W503